<!DOCTYPE html>
<html>
<head>
    <meta charset='UTF-8'>
  <title>Canvas Webgl</title>
  <script type="text/javascript" src='js/stats.min.js'></script>
  <script type="text/javascript" src='js/math.js'></script>
  <script type="text/javascript" src='js/webgl-basic.js'></script>
  <style type="text/css">
    html, body, canvas {
      margin: 0;
      background: #3cbcfc;
    }
    </style>
</head>
<body>
  <canvas id="game" width="640" height="480" style="background: #3cbcfc"></canvas>
  <script id="code">

var AMOUNT_SPRITES = 256;



var stats = new Stats();
document.body.appendChild(stats.dom);

var renderer;

var loop = function () {
    stats.begin();

    renderer.clear();
    updateSprites();
    drawSprites();
    stats.end();
    requestAnimationFrame(loop);
};

var image = new Image();
image.src = 'img/chip.png';


var cx, cy;
var sprites = [];

function updateSprites(dt) {
  for(var i in sprites) {
    sprites[i].angle += sprites[i].speed;
    if(sprites[i].angle >= 360) {
      sprites[i].angle -= 360;
    }
    
    sprites[i].x = cx + Math.floor(sprites[i].center[0] + sprites[i].radius * Math.sin(sprites[i].angle * Math.PI / 180));
    sprites[i].y = cy + Math.floor(sprites[i].center[1] + sprites[i].radius * Math.cos(sprites[i].angle * Math.PI / 180));

  }
}

function drawSprites() {
  for(var i in sprites) {
    renderer.draw(0,0, 24,24, sprites[i].x,sprites[i].y, sprites[i].width,sprites[i].height);
  }
}



window.addEventListener('resize', resizeWindow, false);


function initWindow() {
  var canvas = document.getElementById('game');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  cx = Math.round(canvas.width / 2);
  cy = Math.round(canvas.height / 2);
}

function resizeWindow() {
  var canvas = document.getElementById('game');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  cx = Math.round(canvas.width / 2);
  cy = Math.round(canvas.height / 2);
}

function init() {
  for(var i = 0; i < AMOUNT_SPRITES; i++) {
    sprites[i] = {
      x: 0,
      y: 0,
      center: [- 40 + Math.round(Math.random()*80), - 40 + Math.round(Math.random()*80)],
      radius: 50 + Math.round(Math.random() * 200),
      angle: Math.random()*360,
      speed: 1 + Math.round(Math.random()*5),
      width: 24,
      height: 24
    };
  }
}

image.onload = function() {
  initWindow();

  
  canvas = document.getElementById('game');
  renderer = new WebglRenderer(canvas);
  renderer.addTileset('t1', image);
  
  init();
  loop();
}

  </script>
  
</body>
</html>