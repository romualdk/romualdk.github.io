<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>js13k2018</title>
    <style>
    html, body {
        background-color: #f7f7f7;
        width: 100%;
        height: 100%;
        margin: 0;
        border: 0;
        overflow: hidden; /*  Disable scrollbars */
        display: block;  /* No floating content on sides */
    }

    canvas {
        display: block;
        margin: 30px auto;
        border: 1px solid black;
    }

    #screen {
        border: 0;
    }

    #tileset, #sky, #ground {
        display: none;
    }


    </style>
</head>
<body>
<canvas id="screen"></canvas>
<canvas id="tileset"></canvas>
<canvas id="sky"></canvas>
<canvas id="ground"></canvas>
<script type="text/javascript">
var gamescreen=document.createElement("canvas"),gamectx=gamescreen.getContext("2d");gamescreen.width=420,gamescreen.height=180;var scale=1,canvas=document.getElementById("screen"),ctx=canvas.getContext("2d");canvas.width=gamescreen.width*scale,canvas.height=gamescreen.height*scale;var smoothing=0;function resizeCanvas(){scale=(scale=Math.floor(window.innerWidth/gamescreen.width))<1?1:scale>2?2:scale,canvas.width=gamescreen.width*scale,canvas.height=gamescreen.height*scale}gamectx.mozImageSmoothingEnabled=smoothing,gamectx.msImageSmoothingEnabled=smoothing,gamectx.webkitImageSmoothingEnabled=smoothing,gamectx.imageSmoothingEnabled=smoothing,window.addEventListener("resize",resizeCanvas,!1),resizeCanvas();var colorScheme={standard:{colors:[[0,0,0],[255,156,18],[255,255,255],[250,188,32],[196,98,0],[66,154,215],[127,213,205],[247,247,247],[53,128,0],[255,41,80]],groundColor:3,skyColor:5,cloudColor:7,colorMap:{0:0,127:1,255:2},palettes:[[0,1,2],[5,6,7],[0,3,4],[0,4,1],[0,8,3],[0,8,2],[0,9,3]],palleteMap:[0,0,0,0,0,0,0,0,3,3,4,0,5,6,0,0,1,1,1,2]},grayscale:{colors:[[0,0,0],[160,160,160],[247,247,247]],groundColor:1,skyColor:2,cloudColor:2,colorMap:{0:0,127:1,255:2},palettes:[[0,1,2],[2,2,2],[0,1,0]],palleteMap:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,2]}},currentColorScheme="standard",chrtable=new Image;chrtable.src="data:image/png;base64,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";var tileset=document.getElementById("tileset"),tilesetCtx=tileset.getContext("2d");function colorizeTileset(){tilesetCtx.drawImage(chrtable,0,0);for(var e=tilesetCtx.getImageData(0,0,128,256),t=e.data,i=colorScheme[currentColorScheme],r=0;r<256;r++)for(var n=0;n<128;n++){var a=4*(128*r+n),o=i.colorMap[t[a]],s=4*Math.floor(r/32)+Math.floor(n/32),h=i.palleteMap[s]?i.palleteMap[s]:0,g=i.colors[i.palettes[h][o]];t[a]=g[0],t[a+1]=g[1],t[a+2]=g[2]}tilesetCtx.putImageData(e,0,0)}function getTilePos(e){return[e%8*16,16*Math.floor(e/8)]}tileset.width=128,tileset.height=256;var ground=document.getElementById("ground");function initGround(){ground.width=80*Math.ceil(gamescreen.width/80),ground.height=Math.floor(gamescreen.height/4);var e=colorScheme[currentColorScheme],t=e.colors[e.groundColor];groundCtx.fillStyle="rgb("+t[0]+","+t[1]+","+t[2]+")",groundCtx.fillRect(0,0,ground.width,ground.height);for(var i=Math.floor(5+3*Math.random()),r=getTilePos(70),n=Math.floor(ground.width/i),a=Math.floor(n/3),o=Math.floor(ground.height/8),s=0;s<i;s++){var h=16+s*n+a-Math.floor(Math.random()*a*2),g=Math.floor(ground.height/3)+o-Math.floor(Math.random()*o*2);groundCtx.drawImage(tileset,r[0],r[1],32,32,h,g,32,32)}}groundCtx=ground.getContext("2d");var sky=document.getElementById("sky");function initSky(){sky.width=ground.width,sky.height=gamescreen.height-ground.height;var e=Math.floor(sky.height/3),t=colorScheme[currentColorScheme],i=t.colors[t.skyColor];skyCtx.fillStyle="rgb("+i[0]+","+i[1]+","+i[2]+")",skyCtx.fillRect(0,0,sky.width,sky.height-e);i=t.colors[t.cloudColor];skyCtx.fillStyle="rgb("+i[0]+","+i[1]+","+i[2]+")",skyCtx.fillRect(0,sky.height-e,sky.width,e);for(var r=getTilePos(64),n=0;n<sky.width/80;n++){var a=80*n,o=sky.height-e-32;skyCtx.drawImage(tileset,r[0],r[1],80,32,a,o,80,32)}}skyCtx=sky.getContext("2d");var now,dt=0,last=timestamp(),slow=1,step=1/60,slowStep=slow*step;function timestamp(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}function frame(){for(now=timestamp(),dt+=Math.min(1,(now-last)/1e3);dt>slowStep;)dt-=slowStep,update(step);render(dt/slow),last=now,requestAnimationFrame(frame)}function isMobile(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))}var spritesheet={player:{width:32,height:32,animations:{stand:[0],walk:[0,2,0,4],jump:[16],hurt:[20]},animationSpeed:8,currentAnimation:"stand"}};function Sprite(e){this.x=0,this.y=0,this.vx=0,this.vy=0,this.ax=0,this.ay=0,this.jumping=!1,this.width=spritesheet[e].width,this.height=spritesheet[e].height,this.animations={},this.animationSpeed=spritesheet[e].animationSpeed,this.currentAnimation=spritesheet[e].currentAnimation,this.currentAnimationTile=0;for(var t in spritesheet[e].animations){this.animations[t]=[];for(var i in spritesheet[e].animations[t])this.animations[t][i]=getTilePos(spritesheet[e].animations[t][i])}}Sprite.prototype.update=function(e){this.currentAnimationTile=(this.currentAnimationTile+this.animationSpeed*e)%this.animations[this.currentAnimation].length;var t=this.ay+100*gravity;this.vx+=this.ax*e,this.vy+=t*e,this.x+=this.vx*e,this.y+=this.vy*e,this.y+this.height>spriteGroundY&&(this.y=spriteGroundY-this.height),this.jumping=this.y+this.height<spriteGroundY,this.jumping?this.setCurrentAnimation("jump"):this.setCurrentAnimation("walk")},Sprite.prototype.setCurrentAnimation=function(e){e!==this.currentAnimation&&(this.currentAnimation=e,this.currentAnimationTile=0)},Sprite.prototype.getCurrentTile=function(){return this.animations[this.currentAnimation][Math.floor(this.currentAnimationTile)]};var spriteGroundY,gravity=9.8,groundPos=0,groundSpeed=-100,skyPos=0,skySpeed=-10,player=new Sprite("player");function initPlayer(){spriteGroundY=gamescreen.height-ground.height+4,player.x=16,player.y=spriteGroundY-player.height,player.currentAnimation="walk"}function update(e){(groundPos+=groundSpeed*e)<0&&(groundPos+=ground.width),(skyPos+=skySpeed*e)<0&&(skyPos+=sky.width),player.update(e)}function render(e){gamectx.clearRect(0,0,gamescreen.width,gamescreen.height),gamectx.drawImage(ground,Math.floor(groundPos),gamescreen.height-ground.height),gamectx.drawImage(ground,0,0,ground.width,ground.height,Math.floor(groundPos-ground.width),gamescreen.height-ground.height,ground.width,ground.height),gamectx.drawImage(sky,Math.floor(skyPos),0),gamectx.drawImage(sky,0,0,sky.width,sky.height,Math.floor(skyPos-sky.width),0,sky.width,sky.height);var t=player.getCurrentTile();gamectx.drawImage(tileset,t[0],t[1],player.width,player.height,Math.floor(player.x),Math.floor(player.y),player.width,player.height),ctx.clearRect(0,0,canvas.width,canvas.height),ctx.drawImage(gamescreen,0,0,gamescreen.width,gamescreen.height,0,0,canvas.width,canvas.height)}document.addEventListener("keypress",function(e){player.jumping||"z"!=e.key||(player.vy=-300),"c"==e.key&&"standard"==currentColorScheme?(currentColorScheme="grayscale",colorizeTileset(),initGround(),initSky()):"c"==e.key&&"grayscale"==currentColorScheme&&(currentColorScheme="standard",colorizeTileset(),initGround(),initSky())}),chrtable.onload=function(){colorizeTileset(),initGround(),initSky(),initPlayer(),requestAnimationFrame(frame)};
</script>
</body>
</html>